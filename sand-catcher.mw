include turtle.mw

: place_things # 1 select u place ;
: pack_things # 1 select u dig ;

: non_sand? inspect dup " " = swap " minecraft:sand " = or not ;

: dig_all_sand d non_sand? { } { d dig d move dig_all_sand } ifelse ;
: go_to_chest u detect { } { u move go_to_chest } ifelse ;
: dump_sand # 4 # 4 # 4 u set_echest u drop ;
:: refuel_needed? retry
 push(turtle.getFuelLevel()<5000)
;;
:: refuel retry
 turtle.refuel()
;;
: refuel_if_needed refuel_needed? { # 1 # 1 # 1 u set_echest # 1 u suck_to_count refuel u drop } if ;

" I shouldn't have to do this but for some reason drain_column is pushing a random `false` merely some of the time. " del
: begin " begin " ;
: end dup " begin " = { del } { del end } ifelse ;

: drain_column begin place_things dig_all_sand go_to_chest dump_sand refuel_if_needed pack_things end ;

: drain_chunk # 16 # 16 { drain_column } patrol ;
: next_chunk { f move } # 7 times l turn { f move } # 9 times ;

repl