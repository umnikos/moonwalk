include turtle.mw

: place_things # 1 select place_up # 2 select place ;
: aquire_bucket has_bucket? { } { craft_bucket } ifelse # 3 select ;
: has_bucket? # 3 item_count # 0 = not ;
:: craft retry
 turtle.craft()
;;
: craft_bucket # 1 select # 1 suck_up_to_count # 6 select # 1 suck_up_to_count # 3 select # 1 suck_up_to_count craft ;
: aquire_lava place_down holding_lava_bucket? { success } { down success? { aquire_lava } if } ifelse ;
:: holding_lava_bucket? retry
 local third_item = turtle.getItemDetail(3)
 push(third_item and third_item.name == "minecraft:lava_bucket")
;;
:: give_bucket retry
 while turtle.getItemCount() > 0 and (not turtle.drop()) do
  sleep(3)
 end
;;
: move_somewhere_else # 1 select dig_up dig forward ;
: go_to_surface up success? { go_to_surface } if ;
: do_thing_with_bucket fine_on_fuel? { give_bucket } { refuel } ifelse ;
:: fine_on_fuel? retry
 push(turtle.getFuelLevel() > 2000)
;;
:: refuel retry
 turtle.refuel()
;;
: step place_things aquire_bucket aquire_lava success? go_to_surface { do_thing_with_bucket } { move_somewhere_else } ifelse ;

include repl.mw